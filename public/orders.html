<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Orders - AstroShift</title>
  <link rel="icon"
    href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><defs><radialGradient id=%22grad%22 cx=%2230%25%22 cy=%2230%25%22 r=%2270%25%22><stop offset=%220%25%22 stop-color=%22%2300d4ff%22/><stop offset=%22100%25%22 stop-color=%22%234f7eff%22/></radialGradient></defs><circle cx=%2250%22 cy=%2250%22 r=%2240%22 fill=%22url(%23grad)%22 stroke=%22white%22 stroke-width=%222%22/></svg>">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-dark: #0a0b14;
      --bg-card: #12131f;
      --border-color: rgba(255, 255, 255, 0.08);
      --text-primary: #ffffff;
      --text-secondary: #a0a0b0;
      --primary: #4f7eff;
      --primary-glow: rgba(79, 126, 255, 0.3);
      --accent-green: #00d4aa;
      --accent-yellow: #fbbf24;
      --accent-red: #ff6b7a;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: var(--bg-dark);
      color: var(--text-primary);
      min-height: 100vh;
      line-height: 1.6;
    }

    .stars {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      pointer-events: none;
      z-index: 0;
      background:
        radial-gradient(2px 2px at 20px 30px, rgba(255, 255, 255, 0.3), transparent),
        radial-gradient(2px 2px at 40px 70px, rgba(255, 255, 255, 0.2), transparent),
        radial-gradient(1px 1px at 90px 40px, rgba(255, 255, 255, 0.4), transparent),
        radial-gradient(2px 2px at 130px 80px, rgba(255, 255, 255, 0.2), transparent),
        radial-gradient(1px 1px at 160px 120px, rgba(255, 255, 255, 0.3), transparent);
      background-size: 200px 200px;
    }

    header {
      position: relative;
      z-index: 10;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 50px;
      border-bottom: 1px solid var(--border-color);
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 1.5rem;
      font-weight: 700;
      color: white;
      text-decoration: none;
    }

    .logo-icon {
      width: 40px;
      height: 40px;
      background: radial-gradient(circle at 30% 30%, #00d4ff, #4f7eff);
      border-radius: 50%;
      position: relative;
      box-shadow: 0 0 15px rgba(79, 126, 255, 0.6);
    }

    .logo-icon::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 140%;
      height: 40%;
      border: 2px solid rgba(255, 255, 255, 0.6);
      border-radius: 50%;
      transform: translate(-50%, -50%) rotate(-30deg);
    }

    nav {
      display: flex;
      gap: 30px;
    }

    nav a {
      color: var(--text-secondary);
      text-decoration: none;
      font-size: 0.95rem;
      transition: color 0.2s;
    }

    nav a:hover,
    nav a.active {
      color: white;
    }

    .btn-login {
      padding: 10px 24px;
      background: transparent;
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: white;
      border-radius: 50px;
      text-decoration: none;
      font-weight: 500;
      font-size: 0.9rem;
      transition: all 0.2s;
    }

    .btn-login:hover {
      background: rgba(255, 255, 255, 0.1);
      border-color: rgba(255, 255, 255, 0.3);
    }

    main {
      position: relative;
      z-index: 1;
      max-width: 900px;
      margin: 0 auto;
      padding: 60px 20px;
    }

    .page-header {
      margin-bottom: 40px;
    }

    .page-header h1 {
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 10px;
      background: linear-gradient(135deg, #ffffff, #a5b4fc);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .page-header p {
      color: var(--text-secondary);
    }

    .user-email {
      color: var(--primary);
      font-weight: 500;
    }

    .orders-list {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .order-card {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      padding: 20px 25px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 20px;
      transition: all 0.2s;
      cursor: pointer;
      text-decoration: none;
    }

    .order-card:hover {
      border-color: var(--primary);
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(79, 126, 255, 0.1);
    }

    .order-main {
      flex: 1;
    }

    .order-id {
      font-family: monospace;
      color: var(--text-secondary);
      font-size: 0.85rem;
      margin-bottom: 5px;
    }

    .order-amounts {
      font-size: 1.1rem;
      font-weight: 600;
      color: white;
    }

    .order-amounts .arrow {
      color: var(--primary);
      margin: 0 8px;
    }

    .order-date {
      color: var(--text-secondary);
      font-size: 0.85rem;
      margin-top: 5px;
    }

    .order-status {
      padding: 6px 14px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
      text-transform: uppercase;
    }

    .status-new {
      background: rgba(251, 191, 36, 0.2);
      color: #fbbf24;
    }

    .status-pending {
      background: rgba(79, 126, 255, 0.2);
      color: #4f7eff;
    }

    .status-completed {
      background: rgba(0, 212, 170, 0.2);
      color: #00d4aa;
    }

    .status-expired,
    .status-error {
      background: rgba(255, 107, 122, 0.2);
      color: #ff6b7a;
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-secondary);
    }

    .empty-state .icon {
      font-size: 4rem;
      margin-bottom: 20px;
      opacity: 0.5;
    }

    .empty-state h3 {
      color: white;
      margin-bottom: 10px;
    }

    .empty-state a {
      color: var(--primary);
      text-decoration: none;
    }

    .empty-state a:hover {
      text-decoration: underline;
    }

    .loading {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-secondary);
    }

    .loading .spinner {
      width: 40px;
      height: 40px;
      border: 3px solid var(--border-color);
      border-top-color: var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    .error-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--accent-red);
    }

    @media (max-width: 768px) {
      header {
        padding: 15px 20px;
      }

      nav {
        display: none;
      }

      .page-header h1 {
        font-size: 1.8rem;
      }

      .order-card {
        flex-direction: column;
        align-items: flex-start;
      }
    }
  </style>
</head>

<body>
  <div class="stars"></div>

  <header>
    <a href="/" class="logo">
      <div class="logo-icon"></div>
      AstroShift
    </a>
    <nav>
      <a href="/">Exchange</a>
      <a href="/track.html">Track Order</a>
      <a href="/faq.html">FAQ</a>
      <a href="/support.html">Support</a>
      <a href="/orders.html" class="active">My Orders</a>
    </nav>
    <a href="#" class="btn-login" id="logoutBtn" onclick="logout()">Log Out</a>
  </header>

  <main>
    <div class="page-header">
      <h1>My Orders</h1>
      <p>Logged in as <span class="user-email" id="userEmail">-</span></p>
    </div>

    <div id="content">
      <div class="loading">
        <div class="spinner"></div>
        <p>Loading your orders...</p>
      </div>
    </div>
  </main>

  <script>
    const token = localStorage.getItem('astroshift_token');
    const email = localStorage.getItem('astroshift_email');

    // Redirect if not logged in
    if (!token || !email) {
      window.location.href = '/login.html?redirect=/orders.html';
    }

    document.getElementById('userEmail').textContent = email;

    async function loadOrders() {
      const content = document.getElementById('content');

      try {
        const res = await fetch('/api/user/orders', {
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });

        const data = await res.json();

        if (!data.success) {
          if (res.status === 401) {
            // Token expired, redirect to login
            localStorage.removeItem('astroshift_token');
            localStorage.removeItem('astroshift_email');
            window.location.href = '/login.html?redirect=/orders.html';
            return;
          }
          throw new Error(data.error || 'Failed to load orders');
        }

        const ordersList = data.orders || [];

        if (!ordersList || ordersList.length === 0) {
          content.innerHTML = `
            <div class="empty-state">
              <div class="icon">ðŸ“¦</div>
              <h3>No orders yet</h3>
              <p>You haven't made any exchanges yet.<br><a href="/">Start your first exchange â†’</a></p>
            </div>
          `;
          return;
        }

        // Render orders
        let html = '<div class="orders-list">';
        for (const order of ordersList) {
          const statusClass = getStatusClass(order.status);
          const date = new Date(order.createdAt).toLocaleDateString('en-US', {
            month: 'short',
            day: 'numeric',
            year: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
          });

          html += `
            <a href="/order.html?id=${order.id}" class="order-card">
              <div class="order-main">
                <div class="order-id">#${order.id.substring(0, 8).toUpperCase()}</div>
                <div class="order-amounts">
                  ${order.fromAmount} ${order.fromCcy}
                  <span class="arrow">â†’</span>
                  ${order.toAmount} ${order.toCcy}
                </div>
                <div class="order-date">${date}</div>
              </div>
              <span class="order-status ${statusClass}">${order.status}</span>
            </a>
          `;
        }
        html += '</div>';
        content.innerHTML = html;

      } catch (error) {
        console.error('Load orders error:', error);
        content.innerHTML = `
          <div class="error-state">
            <p>Failed to load orders. <a href="javascript:location.reload()">Try again</a></p>
          </div>
        `;
      }
    }

    function getStatusClass(status) {
      switch (status?.toUpperCase()) {
        case 'NEW': return 'status-new';
        case 'PENDING':
        case 'PROCESSING':
        case 'EXCHANGE':
        case 'CONFIRMATION':
          return 'status-pending';
        case 'DONE':
        case 'COMPLETED':
          return 'status-completed';
        case 'EXPIRED':
        case 'EMERGENCY':
        case 'REFUND':
          return 'status-expired';
        default: return 'status-pending';
      }
    }

    function logout() {
      localStorage.removeItem('astroshift_token');
      localStorage.removeItem('astroshift_email');
      window.location.href = '/';
    }

    loadOrders();
  </script>
</body>

</html>